<div class="container-fluid">
  <div class="block-header">
    <h2>Category > Manage Categories</h2>
  </div>
  <!-- Vertical Layout -->
  <div class="row">
    <div class="col-lg-12 col-md-12">
      <div class="card">
        <div class="header">
          <h2>Add Category</h2>
        </div>
        <div class="body">
          <div class="row">
            <div class="col-md-12" style="margin-bottom: 0">
              <div class="add_category_form_alert"></div>
              <form method="POST" id="add_category_form">
                <div class="row">
                  <?php foreach ($pt->langs as $key => $lang) { ?>
                  <div class="col-md-2" id="normal-query-form">
                    <div class="form-group form-float">
                      <div class="form-line">
                        <input
                          type="text"
                          class="form-control"
                          name="<?php echo($lang) ?>"
                        />
                        <label class="form-label"
                          ><?php echo ucfirst($lang); ?></label
                        >
                      </div>
                    </div>
                  </div>
                  <?php } ?>
                  <div class="clearfix"></div>
                  <div class="col-md-12">
                    <div
                      class="upload-product-image pull-left"
                      onclick="document.getElementById('thumbnail').click(); return false"
                    >
                      <div class="upload-image-content">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          class="feather feather-camera"
                        >
                          <path
                            d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                          ></path>
                          <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                      </div>
                    </div>
                    <div style="overflow-x: auto; width: calc(100% - 112px)">
                      <div id="productimage-holder"></div>
                    </div>
                    <input
                      id="thumbnail"
                      name="image"
                      type="file"
                      class="hidden"
                      accept="image/*"
                    />
                    <span class="help-block">jpg, png, gif</span>
                  </div>
                  <div class="col-md-2">
                    <button class="btn btn-info">Add</button>
                  </div>
                </div>
                <div class="clearfix"></div>
                <input
                  type="file"
                  class="hidden"
                  id="article-image"
                  name="image"
                />
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-12 col-md-12">
      <div class="card">
        <div class="header">
          <h2>Manage Categories</h2>
        </div>
        <div class="body">
          <div class="clearfix"></div>
          <div class="table-responsive1">
            <table class="table table-bordered table-striped table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Category Name</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <?php 
                                foreach ($pt->categories as $key => $category) {
                $pt->category_key = $key; echo
                PT_LoadAdminPage('manage_categories/list', array('ID' => $key,
                'CAT_ID' => $key, 'CAT_NAME' => $category)); } ?>
              </tbody>
            </table>
          </div>
          <div class="clearfix"></div>
        </div>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
  <!-- #END# Vertical Layout -->
  <div id="delete-modal" class="modal fade" role="dialog" data-id="">
    <div class="modal-dialog">
      <div class="modal-content modal-col-red">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">
            &times;
          </button>
          <h4 class="modal-title">DELETE Category</h4>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to continue? this action can't be undo</p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-link waves-effect"
            data-dismiss="modal"
            data-type="user"
            id="delete_sub"
          >
            DELETE
          </button>
          <button
            type="button"
            class="btn btn-link waves-effect"
            data-dismiss="modal"
          >
            CLOSE
          </button>
        </div>
      </div>
    </div>
  </div>

  <div
    class="modal fade"
    id="editcategoryModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog" role="document">
      <div class="modal-content modal_content_back">
        <div class="modal-header">
          <h5 class="modal-title" id="editcategoryModalLabel">Edit Category</h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="edit_category_form_alert"></div>
          <form
            class="edit_category_lang"
            method="POST"
            id="modal-body-langs"
          ></form>
        </div>
        <div class="modal-footer">
          <input type="hidden" id="c_id_" />
          <button
            type="button"
            class="btn btn-secondary modal_close_btn"
            data-dismiss="modal"
          >
            {{LANG close}}
          </button>
          <button
            type="button"
            class="btn btn-primary"
            id="save_edited_category"
          >
            {{LANG save}}
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    var add_category_form = $("form#add_category_form");
    var edit_category_form = $("form.edit_category_lang");

    add_category_form.ajaxForm({
      url: "{{LINK aj/ap/add_new_category}}",
      beforeSend: function () {
        add_category_form.find(".waves-effect").text("{{LANG please_wait}}");
      },
      success: function (data) {
        if (data.status == 200) {
          add_category_form.find(".waves-effect").text("Save");
          $(".add_category_form_alert").html(
            '<div class="alert alert-success"><i class="fa fa-check"></i> Category successfully added</div>'
          );
          setTimeout(function () {
            $(".add_category_form_alert").empty();
          }, 2000);
          window.location.reload();
        } else {
          $(".add_category_form_alert").html(
            '<div class="alert alert-danger"><i class="fa fa-check"></i> ' +
              data.message +
              "</div>"
          );
          setTimeout(function () {
            $(".add_category_form_alert").empty();
          }, 2000);
        }
      },
    });

    edit_category_form.ajaxForm({
      url: "{{LINK aj/ap/edit_category}}",
      beforeSend: function () {
        edit_category_form.find(".waves-effect").text("{{LANG please_wait}}");
      },
      success: function (data) {
        if (data.status == 200) {
          edit_category_form.find(".waves-effect").text("Save");
          $(".edit_category_form_alert").html(
            '<div class="alert alert-success"><i class="fa fa-check"></i> Category successfully edited</div>'
          );
          setTimeout(function () {
            $(".edit_category_form_alert").empty();
          }, 3000);
          window.location.reload();
        } else {
          $(".edit_category_form_alert").html(
            '<div class="alert alert-danger"><i class="fa fa-check"></i> ' +
              data.message +
              "</div>"
          );
          setTimeout(function () {
            $(".edit_category_form_alert").empty();
          }, 2000);
        }
      },
    });

    $(document).on("click", "#save_edited_category", function (event) {
      event.preventDefault();
      $(".edit_category_lang").submit();
    });

    function edit_category(id) {
      $.post("{{LINK aj/ap/get_category_langs}}", { lang_key: id }, function (
        data,
        textStatus,
        xhr
      ) {
        if (data.status == 200) {
          $("#modal-body-langs").html(data.html);
          $("#editcategoryModal").modal();
        }
      });
    }

    $(".delete-content").on("click", function (event) {
      event.preventDefault();
      $("#delete-modal").attr("data-id", $(this).attr("data-id")).modal("show");
    });

    $(document).on("click", "#delete_sub", function (event) {
      event.preventDefault();
      lang_key = $("#delete-modal").attr("data-id");
      $.post(
        "{{LINK aj/ap/delete_category}}",
        { lang_key: lang_key },
        function (data, textStatus, xhr) {
          if (data.status == 200) {
            $("#list-" + lang_key).slideUp("slow");
            setTimeout(function () {
              $("#list-" + lang_key).remove();
            }, 2000);
          }
        }
      );
    });

    $(document).ready(function () {
      $("#thumbnail").on("change", function () {
        //Get count of selected files
        var product_countFiles = $(this)[0].files.length;
        var product_imgPath = $(this)[0].value;
        var extn = product_imgPath
          .substring(product_imgPath.lastIndexOf(".") + 1)
          .toLowerCase();
        var product_image_holder = $("#productimage-holder");
        product_image_holder.empty();
        if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
          if (typeof FileReader != "undefined") {
            //loop for each file selected for uploaded.
            for (var i = 0; i < product_countFiles; i++) {
              var product_reader = new FileReader();
              product_reader.onload = function (e) {
                $("<img />", {
                  src: e.target.result,
                  class: "thumb-image",
                }).appendTo(product_image_holder);
              };
              product_image_holder.show();
              product_reader.readAsDataURL($(this)[0].files[i]);
            }
          } else {
            product_image_holder.html(
              "<p>This browser does not support FileReader.</p>"
            );
          }
        }
      });
    });
  </script>
</div>

</script>